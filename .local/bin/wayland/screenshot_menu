#!/bin/bash


get_filename()
{
    printf $HOME/Pictures/Screenshots/$(date +"%Y-%m-%d_%H:%M:%S")'.png'
}


region()
{
    grim -g "$(slurp)" ${filename}
}

active_window()
{
    # cheekily copied from https://github.com/equk/dotfiles/blob/master/configs/bin/screenactive
    hyprctl -j activewindow | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"' |
        grim -g - ${filename}
}

fullscreen()
{
    grim -o $(hyprctl -j activeworkspace | jq -r '(.monitor)') ${filename}
}

show=(region active_window fullscreen)


declare -A labels
labels[region]="pick Region"
labels[active_window]="active Window"
labels[fullscreen]="Fullscreen"


declare -A actions
actions[region]=region
actions[active_window]=active_window
actions[fullscreen]=fullscreen


pick_action()
{
    for entry in "${show[@]}"
    do
        echo ${labels[$entry]}
    done | dmenu -l ${#show[@]} -theme-str 'window {width: 250px;} inputbar {enabled: false;}'

    # sleep for a second to wait for dmenu to fade away
    # otherwise, it might end up in the screenshot
    sleep 1
}


perform_action()
{
    filename=$(get_filename)

    for entry in "${show[@]}"
    do
        if [[ "$1" == "${labels[$entry]}" ]]
        then
            eval ${actions[$entry]}

            if [ -e ${filename} ]
            then
                notify-send "Screenshot saved" "${filename}"
                wl-copy "${filename}"
            fi
        fi
    done
}

perform_action "${1:-$(pick_action)}"
